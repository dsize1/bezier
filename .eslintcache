[{"D:\\前端\\react基础架构\\bezier\\src\\index.tsx":"1","D:\\前端\\react基础架构\\bezier\\src\\reportWebVitals.ts":"2","D:\\前端\\react基础架构\\bezier\\src\\App.tsx":"3","D:\\前端\\react基础架构\\bezier\\src\\components\\ControlPoints\\index.tsx":"4","D:\\前端\\react基础架构\\bezier\\src\\models\\controlPoints.ts":"5","D:\\前端\\react基础架构\\bezier\\src\\components\\Stage\\index.tsx":"6","D:\\前端\\react基础架构\\bezier\\src\\utils\\index.ts":"7","D:\\前端\\react基础架构\\bezier\\src\\utils\\toFixed.ts":"8","D:\\前端\\react基础架构\\bezier\\src\\components\\ControlPoints\\InputRange.tsx":"9","D:\\前端\\react基础架构\\bezier\\src\\components\\Stage\\contants.ts":"10","D:\\前端\\react基础架构\\bezier\\src\\components\\Stage\\draws.ts":"11","D:\\前端\\react基础架构\\bezier\\src\\utils\\calculateBezier.ts":"12","D:\\前端\\react基础架构\\bezier\\src\\utils\\getStyleCls.ts":"13","D:\\前端\\react基础架构\\bezier\\src\\models\\controlPlayer.ts":"14","D:\\前端\\react基础架构\\bezier\\src\\utils\\p2CubicBezier.ts":"15","D:\\前端\\react基础架构\\bezier\\src\\components\\Compare\\index.tsx":"16","D:\\前端\\react基础架构\\bezier\\src\\hooks\\useResize.ts":"17","D:\\前端\\react基础架构\\bezier\\src\\hooks\\useMulticast.ts":"18","D:\\前端\\react基础架构\\bezier\\src\\utils\\getMotion$.ts":"19","D:\\前端\\react基础架构\\bezier\\src\\utils\\getCtxByStage.ts":"20","D:\\前端\\react基础架构\\bezier\\src\\utils\\drawPoint.ts":"21","D:\\前端\\react基础架构\\bezier\\src\\components\\Display\\index.tsx":"22","D:\\前端\\react基础架构\\bezier\\src\\Canvas\\index.ts":"23","D:\\前端\\react基础架构\\bezier\\src\\Canvas\\Shape\\Circle.ts":"24","D:\\前端\\react基础架构\\bezier\\src\\Canvas\\Shape\\Rectangle.ts":"25","D:\\前端\\react基础架构\\bezier\\src\\utils\\cubicBezier2p.ts":"26","D:\\前端\\react基础架构\\bezier\\src\\Canvas\\utils\\Movement.ts":"27","D:\\前端\\react基础架构\\bezier\\src\\Canvas\\utils\\getMovements$.ts":"28","D:\\前端\\react基础架构\\bezier\\src\\Canvas\\utils\\getAbsolutePosition.ts":"29","D:\\前端\\react基础架构\\bezier\\src\\pages\\Quadtree\\index.tsx":"30","D:\\前端\\react基础架构\\bezier\\src\\utils\\random.ts":"31","D:\\前端\\react基础架构\\bezier\\src\\Canvas\\utils\\Shapes.ts":"32"},{"size":500,"mtime":1607750933546,"results":"33","hashOfConfig":"34"},{"size":425,"mtime":1607745288397,"results":"35","hashOfConfig":"34"},{"size":302,"mtime":1611581752519,"results":"36","hashOfConfig":"34"},{"size":6000,"mtime":1610213019139,"results":"37","hashOfConfig":"34"},{"size":635,"mtime":1610203710086,"results":"38","hashOfConfig":"34"},{"size":2809,"mtime":1609257336242,"results":"39","hashOfConfig":"34"},{"size":830,"mtime":1611582711636,"results":"40","hashOfConfig":"34"},{"size":359,"mtime":1607757739271,"results":"41","hashOfConfig":"34"},{"size":1009,"mtime":1608044940771,"results":"42","hashOfConfig":"34"},{"size":430,"mtime":1608649541837,"results":"43","hashOfConfig":"34"},{"size":4153,"mtime":1608649993050,"results":"44","hashOfConfig":"34"},{"size":761,"mtime":1610192228946,"results":"45","hashOfConfig":"34"},{"size":476,"mtime":1608047674449,"results":"46","hashOfConfig":"34"},{"size":429,"mtime":1608649868864,"results":"47","hashOfConfig":"34"},{"size":491,"mtime":1610204135818,"results":"48","hashOfConfig":"34"},{"size":1247,"mtime":1608649959108,"results":"49","hashOfConfig":"34"},{"size":1031,"mtime":1608990596266,"results":"50","hashOfConfig":"34"},{"size":1469,"mtime":1608652027482,"results":"51","hashOfConfig":"34"},{"size":2952,"mtime":1610189413933,"results":"52","hashOfConfig":"34"},{"size":202,"mtime":1608479298543,"results":"53","hashOfConfig":"34"},{"size":390,"mtime":1608479563649,"results":"54","hashOfConfig":"34"},{"size":3075,"mtime":1610215173010,"results":"55","hashOfConfig":"34"},{"size":5804,"mtime":1611589538376,"results":"56","hashOfConfig":"34"},{"size":2397,"mtime":1611244590480,"results":"57","hashOfConfig":"34"},{"size":2442,"mtime":1611244538882,"results":"58","hashOfConfig":"34"},{"size":1353,"mtime":1610215094310,"results":"59","hashOfConfig":"34"},{"size":922,"mtime":1610210859947,"results":"60","hashOfConfig":"34"},{"size":4826,"mtime":1611242314302,"results":"61","hashOfConfig":"34"},{"size":735,"mtime":1610195050301,"results":"62","hashOfConfig":"34"},{"size":2424,"mtime":1611589618434,"results":"63","hashOfConfig":"34"},{"size":129,"mtime":1611582838952,"results":"64","hashOfConfig":"34"},{"size":11718,"mtime":1611675394306,"results":"65","hashOfConfig":"34"},{"filePath":"66","messages":"67","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"68"},"j32ste",{"filePath":"69","messages":"70","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"68"},{"filePath":"71","messages":"72","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"68"},{"filePath":"73","messages":"74","errorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"75","usedDeprecatedRules":"76"},{"filePath":"77","messages":"78","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"76"},{"filePath":"79","messages":"80","errorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"81","usedDeprecatedRules":"76"},{"filePath":"82","messages":"83","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"68"},{"filePath":"84","messages":"85","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"68"},{"filePath":"86","messages":"87","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"76"},{"filePath":"88","messages":"89","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"76"},{"filePath":"90","messages":"91","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"76"},{"filePath":"92","messages":"93","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"68"},{"filePath":"94","messages":"95","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"68"},{"filePath":"96","messages":"97","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"76"},{"filePath":"98","messages":"99","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"68"},{"filePath":"100","messages":"101","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"76"},{"filePath":"102","messages":"103","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"76"},{"filePath":"104","messages":"105","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"76"},{"filePath":"106","messages":"107","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"68"},{"filePath":"108","messages":"109","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"68"},{"filePath":"110","messages":"111","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"68"},{"filePath":"112","messages":"113","errorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"114","usedDeprecatedRules":"76"},{"filePath":"115","messages":"116","errorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"117","usedDeprecatedRules":"68"},{"filePath":"118","messages":"119","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"68"},{"filePath":"120","messages":"121","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"68"},{"filePath":"122","messages":"123","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"68"},{"filePath":"124","messages":"125","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"68"},{"filePath":"126","messages":"127","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"68"},{"filePath":"128","messages":"129","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"76"},{"filePath":"130","messages":"131","errorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"132","usedDeprecatedRules":"68"},{"filePath":"133","messages":"134","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"68"},{"filePath":"135","messages":"136","errorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":null},"D:\\前端\\react基础架构\\bezier\\src\\index.tsx",[],["137","138"],"D:\\前端\\react基础架构\\bezier\\src\\reportWebVitals.ts",[],"D:\\前端\\react基础架构\\bezier\\src\\App.tsx",[],"D:\\前端\\react基础架构\\bezier\\src\\components\\ControlPoints\\index.tsx",["139"],"import React, { useMemo } from 'react';\r\nimport { Form, Button, Select, Row, Col } from 'antd';\r\nimport { CopyrightTwoTone } from '@ant-design/icons';\r\nimport InputRange from './InputRange';\r\nimport _omit from 'lodash/omit';\r\nimport _split from 'lodash/split';\r\nimport _map from 'lodash/map';\r\nimport _has from 'lodash/has';\r\nimport utils from '../../utils'\r\nimport { IControlPoints } from '../../models/controlPoints';\r\nimport useControlPoints from '../../models/controlPoints'\r\nimport useControlPlayer from '../../models/controlPlayer'\r\n\r\nconst libaray = [\r\n  { label: 'ease', value: '.25,.1,.25,1' },\r\n  { label: 'linear', value: '0,0,1,1' },\r\n  { label: 'ease-in', value: '.42,0,1,1' },\r\n  { label: 'ease-out', value: '0,0,.58,1' },\r\n  { label: 'ease-in-out', value: '.42,0,.58,1' }\r\n]\r\n\r\ninterface IForm extends Omit<IControlPoints, 'cubicBezier'> {\r\n  libaray: string | undefined;\r\n  duration: number;\r\n}\r\n\r\nfunction ControlPoints(props: Partial<{ className: string }>) {\r\n  const { className } = props;\r\n\r\n  const { initialPoints, points, setPoints } = useControlPoints();\r\n  const { initialPlayer, player, setPlayer } = useControlPlayer();\r\n  const [form] = Form.useForm<IForm>();\r\n  const initialFormValues = useMemo(() => {\r\n    return {\r\n      libaray: undefined,\r\n      ...initialPoints,\r\n    }\r\n  }, [initialPoints])\r\n\r\n  const onFinish = (values: IForm, run = true) => {\r\n    if (!player.run) {\r\n      const nextPoints = _omit(values, ['libaray']);\r\n      const { cp1x, cp1y, cp2x, cp2y } = nextPoints;\r\n      const cubicBezier = utils.p2CubicBezier({ cp1x, cp1y, cp2x, cp2y });\r\n      setPoints({ ...nextPoints, cubicBezier });\r\n      setPlayer({ run });\r\n    }\r\n  }\r\n\r\n  const onReset = () => {\r\n    const formValues = {\r\n      ...initialPoints,\r\n      libaray: undefined\r\n    };\r\n    form.setFieldsValue(formValues);\r\n    onFinish(formValues, false);\r\n  }\r\n\r\n  const onFormChange = (changedValues: Partial<IForm>, allValues: IForm) => {\r\n    if (_has(changedValues, 'libaray')) {\r\n      if (changedValues.libaray === undefined) {\r\n        onReset();\r\n      } else {\r\n        const cps = _split(changedValues.libaray, ',');\r\n        const [cp1x, cp1y, cp2x, cp2y] = _map(cps, Number);\r\n        const formValues = {\r\n          duration: allValues.duration,\r\n          libaray: changedValues.libaray,\r\n          cp1x,\r\n          cp1y,\r\n          cp2x,\r\n          cp2y\r\n        };\r\n        form.setFieldsValue(formValues);\r\n        onFinish(formValues, false);\r\n      }\r\n    } else {\r\n      const formValues = {\r\n        ...allValues,\r\n        libaray: undefined\r\n      };\r\n      form.setFieldsValue(formValues);\r\n      onFinish(formValues, false);\r\n    }\r\n  }\r\n\r\n  return (\r\n    <Form\r\n      className={className}\r\n      form={form} \r\n      initialValues={initialFormValues} \r\n      name=\"control-points\" \r\n      onFinish={onFinish} \r\n      onValuesChange={onFormChange}\r\n      labelCol={{ span: 8 }}\r\n      wrapperCol={{ span: 16 }}\r\n    >\r\n      <Row justify=\"start\" >\r\n        <Col span={10}>\r\n          <Form.Item\r\n            name=\"cp1x\"\r\n            label={\r\n              <span>\r\n                控制点X1\r\n                <CopyrightTwoTone twoToneColor=\"#52c41a\" style={{marginLeft: 6}} />\r\n              </span>\r\n            }\r\n            rules={[{ required: true }]}\r\n          >\r\n            <InputRange min={0} max={1} step={0.01} />\r\n          </Form.Item>\r\n        </Col>\r\n        <Col span={10}>\r\n          <Form.Item\r\n            name=\"cp1y\"\r\n            label={\r\n              <span>\r\n                控制点Y1\r\n                <CopyrightTwoTone twoToneColor=\"#52c41a\" style={{marginLeft: 6}} />\r\n              </span>\r\n            }\r\n            rules={[{ required: true }]}\r\n          >\r\n            <InputRange min={-1} max={2} step={0.01} />\r\n          </Form.Item>\r\n        </Col>\r\n      </Row>\r\n      <Row justify=\"start\" >\r\n        <Col span={10}>\r\n          <Form.Item\r\n            name=\"cp2x\"\r\n            label={\r\n              <span>\r\n                控制点X2\r\n                <CopyrightTwoTone twoToneColor=\"#ff5722\" style={{marginLeft: 6}} />\r\n              </span>\r\n            }\r\n            rules={[{ required: true }]}\r\n          >\r\n            <InputRange min={0} max={1} step={0.01} />\r\n          </Form.Item>\r\n        </Col>\r\n        <Col span={10}>\r\n          <Form.Item\r\n            name=\"cp2y\"\r\n            label={\r\n              <span>\r\n                控制定Y2\r\n                <CopyrightTwoTone twoToneColor=\"#ff5722\" style={{marginLeft: 6}} />\r\n              </span>\r\n            }\r\n            rules={[{ required: true }]}\r\n          >\r\n            <InputRange min={-1} max={2} step={0.01} />\r\n          </Form.Item>\r\n        </Col>\r\n      </Row>\r\n      <Row justify=\"start\" >\r\n        <Col span={10}>\r\n          <Form.Item\r\n            name=\"libaray\"\r\n            label=\"缓动函数\"\r\n          >\r\n            <Select\r\n              size=\"small\"\r\n              style={{ width: 200 }}\r\n              options={libaray}\r\n              optionLabelProp=\"label\"\r\n              allowClear\r\n            />\r\n          </Form.Item>\r\n        </Col>\r\n        <Col span={10}>\r\n          <Form.Item\r\n            name=\"duration\"\r\n            label=\"时间\"\r\n            rules={[{ required: true }]}\r\n          >\r\n            <InputRange min={initialPoints.duration} max={10000} step={500} />\r\n          </Form.Item>\r\n        </Col>\r\n      </Row>\r\n      <Row justify=\"start\" >        \r\n        <Col span={10}>\r\n          <Form.Item label=\"贝塞尔曲线\">\r\n            <span>{points.cubicBezier}</span>\r\n          </Form.Item>\r\n        </Col>\r\n        <Col span={10} offset={4} >\r\n          <Form.Item>\r\n            <Button type=\"primary\" htmlType=\"submit\">\r\n              开始\r\n            </Button>\r\n            <Button style={{ marginLeft: 12 }} htmlType=\"button\" onClick={onReset}>\r\n              重置\r\n            </Button>\r\n          </Form.Item>\r\n        </Col>\r\n      </Row>\r\n    </Form>\r\n  );\r\n}\r\n\r\nexport default ControlPoints;\r\n",["140","141"],"D:\\前端\\react基础架构\\bezier\\src\\models\\controlPoints.ts",[],"D:\\前端\\react基础架构\\bezier\\src\\components\\Stage\\index.tsx",["142","143"],"import React, { useMemo, useRef } from 'react';\r\nimport { of, concat } from 'rxjs';\r\nimport { tap, map, filter, withLatestFrom } from 'rxjs/operators';\r\nimport useResize from '../../hooks/useResize';\r\nimport useControlPoints from '../../models/controlPoints';\r\nimport useControlPlayer from '../../models/controlPlayer';\r\nimport useMulticast from '../../hooks/useMulticast';\r\nimport { drawCoordinates, drawBezierCurvePoint, getPoints$ } from './draws';\r\nimport { PADDING } from './contants';\r\nimport { IStageOptions, IDrawCoordinatesOptions, IDrawBezierCurveOptions } from './types';\r\n\r\nfunction Stage (props: Partial<{ className: string }>) {\r\n  const { className } = props;\r\n\r\n  const containerRef = useRef<HTMLDivElement>(null);\r\n  const canvasRef = useRef<HTMLCanvasElement>(null);\r\n\r\n  const { width, height } = useResize(containerRef.current);\r\n\r\n  const { points: controlPonitsOptions } = useControlPoints();\r\n  const { player: controlPlayer, setPlayer: setControlPonitsPlayer } = useControlPlayer();\r\n\r\n  const stageOptions: IStageOptions = useMemo(() => {\r\n    const _width = Math.floor(width);\r\n    const _height = Math.floor(height);\r\n    const axisXLength = Math.floor(_width - (2 * PADDING));\r\n    const axisYLength = Math.floor((1 / 3)  * (_height - (2 * PADDING)));\r\n    const originX = PADDING;\r\n    const originY = 2 * axisYLength + PADDING;\r\n\r\n    return {\r\n      x0: originX,\r\n      y0: originY,\r\n      xLen: axisXLength,\r\n      yLen: axisYLength,\r\n      stageW: _width,\r\n      stageH: _height,\r\n      stage: canvasRef\r\n    };\r\n  }, [width, height]);\r\n\r\n  const drawBezierCurve = ([stageOptions, controlPonits, controlPlayer]: IDrawBezierCurveOptions) => {\r\n    console.log('ddd', controlPlayer);\r\n    const clear$ = of<IDrawCoordinatesOptions>([stageOptions, controlPonits]).pipe(\r\n      tap(drawCoordinates)\r\n    );\r\n    const drawPoints$ = getPoints$(stageOptions, controlPonits, controlPlayer).pipe(\r\n      tap(drawBezierCurvePoint)\r\n    );\r\n    const draw$ = concat(clear$, drawPoints$);\r\n    draw$.subscribe({\r\n      complete: () => {\r\n        setControlPonitsPlayer({ ...controlPlayer, run: false });\r\n      },\r\n      error: () => {\r\n        setControlPonitsPlayer({ ...controlPlayer, run: false });\r\n      }\r\n    });\r\n  }\r\n\r\n  useMulticast<IDrawCoordinatesOptions>(\r\n    [drawCoordinates],\r\n    [stageOptions, controlPonitsOptions]\r\n  );\r\n\r\n  useMulticast<IDrawBezierCurveOptions>(\r\n    [drawBezierCurve],\r\n    [stageOptions, controlPonitsOptions, controlPlayer],\r\n    (dependency$) => {\r\n      return dependency$.pipe(\r\n        filter((dep) => dep[2].run)\r\n      );\r\n    }\r\n  );\r\n\r\n  return (\r\n    <div className={className} ref={containerRef}>\r\n      <canvas ref={canvasRef} width={stageOptions.stageW} height={stageOptions.stageH} />\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default Stage;\r\n","D:\\前端\\react基础架构\\bezier\\src\\utils\\index.ts",[],"D:\\前端\\react基础架构\\bezier\\src\\utils\\toFixed.ts",[],"D:\\前端\\react基础架构\\bezier\\src\\components\\ControlPoints\\InputRange.tsx",[],"D:\\前端\\react基础架构\\bezier\\src\\components\\Stage\\contants.ts",[],"D:\\前端\\react基础架构\\bezier\\src\\components\\Stage\\draws.ts",[],"D:\\前端\\react基础架构\\bezier\\src\\utils\\calculateBezier.ts",[],"D:\\前端\\react基础架构\\bezier\\src\\utils\\getStyleCls.ts",[],"D:\\前端\\react基础架构\\bezier\\src\\models\\controlPlayer.ts",[],"D:\\前端\\react基础架构\\bezier\\src\\utils\\p2CubicBezier.ts",[],"D:\\前端\\react基础架构\\bezier\\src\\components\\Compare\\index.tsx",[],"D:\\前端\\react基础架构\\bezier\\src\\hooks\\useResize.ts",[],"D:\\前端\\react基础架构\\bezier\\src\\hooks\\useMulticast.ts",[],"D:\\前端\\react基础架构\\bezier\\src\\utils\\getMotion$.ts",[],"D:\\前端\\react基础架构\\bezier\\src\\utils\\getCtxByStage.ts",[],"D:\\前端\\react基础架构\\bezier\\src\\utils\\drawPoint.ts",[],"D:\\前端\\react基础架构\\bezier\\src\\components\\Display\\index.tsx",["144","145","146","147"],"import React, { useEffect, useMemo, useRef, useState } from 'react';\r\nimport useConstant from 'use-constant';\r\nimport { tap, filter } from 'rxjs/operators';\r\nimport { useObservable } from \"rxjs-hooks\";\r\nimport utils from '../../utils';\r\nimport getAbsolutePosition from '../../Canvas/utils/getAbsolutePosition';\r\nimport Canvas from '../../Canvas';\r\nimport Circle from '../../Canvas/Shape/Circle';\r\nimport Rectangle from '../../Canvas/Shape/Rectangle';\r\nimport useControlPoints from '../../models/controlPoints';\r\nimport useControlPlayer from '../../models/controlPlayer';\r\nimport { DUE_TIME } from '../Stage/contants';\r\nimport { IDrawBallMotionOptions } from './types';\r\nimport { IPoint } from '../../types';\r\nimport styles from './display.module.css';\r\n\r\nconst getCls = utils.getStyleCls(styles);\r\n\r\nconst BALL_RADIUS = 12.5;\r\nconst BALL_BOTTOM = 756;\r\nconst BALL_TOP = 181;\r\nconst BALL_COLOR = '#d87093';\r\nconst RECT_HEIGHT = 600;\r\nconst RECT_COLOR = '#ffffff';\r\nconst RECT = {\r\n  x: 0,\r\n  y: 168.5,\r\n  width: '100%',\r\n  height: RECT_HEIGHT,\r\n  fillStyle: RECT_COLOR \r\n};\r\nconst BALL = {\r\n  x: 84,\r\n  y: 756,\r\n  radius: BALL_RADIUS,\r\n  fillStyle: BALL_COLOR\r\n};\r\n\r\nfunction Display() {\r\n  const containerRef = useRef<HTMLDivElement>(null);\r\n  const canvasRef = useRef<Canvas>();\r\n  const rect = useConstant(() => new Rectangle({\r\n    ...RECT,\r\n    width: 0\r\n  }));\r\n  const ball = useConstant(() => new Circle(BALL));\r\n\r\n  useEffect(() => {\r\n    if (containerRef.current) {\r\n      canvasRef.current = new Canvas(containerRef.current);\r\n      canvasRef?.current?.init(\r\n        (canvasSize, context, canvas) => {\r\n          canvas.append(rect.id, rect);\r\n          canvas.append(ball.id, ball);\r\n          const rectWidth = getAbsolutePosition(RECT.width, 'width', canvasSize);\r\n          canvas.change(rect.id, { width: rectWidth });\r\n          canvas.drawShapes();\r\n        }\r\n      );\r\n    }\r\n    return () => {\r\n      canvasRef?.current?.destroy();\r\n    }\r\n  // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, []);\r\n\r\n  const { points: controlPonits } = useControlPoints();\r\n  const { player: controlPlayer } = useControlPlayer();\r\n\r\n  useObservable((_, inputs$) => inputs$.pipe(\r\n    filter((inputs) => {\r\n      const isInitiated = canvasRef?.current?.isInitiated ?? false;\r\n      const run = inputs[1].run;\r\n      return isInitiated && run;\r\n    }),\r\n    tap(([controlPonitsOptions]) => {\r\n      const endY = ball.y === BALL_BOTTOM ? BALL_TOP : BALL_BOTTOM;\r\n      const unit = {\r\n        shape: ball,\r\n        state: { y: endY },\r\n        cubicBezier: controlPonitsOptions.cubicBezier,\r\n        delay: DUE_TIME,\r\n        duration: controlPonitsOptions.duration\r\n      };\r\n      canvasRef?.current?.move(\r\n        unit,\r\n        {\r\n          moving: (_, canvas) => {\r\n            canvas.clear();\r\n            canvas.drawShapes();\r\n          }\r\n        }\r\n      );\r\n    }),\r\n  ), [controlPonits, controlPlayer], [controlPonits, controlPlayer])\r\n\r\n  return (\r\n    <div className={getCls('container')} ref={containerRef} />\r\n  );\r\n}\r\n\r\nexport default Display;\r\n","D:\\前端\\react基础架构\\bezier\\src\\Canvas\\index.ts",["148"],"import { ResizeObserver } from '@juggle/resize-observer';\r\nimport { tap } from 'rxjs/operators';\r\nimport { v4 } from 'uuid';\r\nimport _isFunction from 'lodash/isFunction';\r\nimport _each from 'lodash/each';\r\nimport _isArray from 'lodash/isArray';\r\nimport Rectangle from './Shape/Rectangle';\r\nimport Shapes from './utils/Shapes';\r\nimport getMovements$ from './utils/getMovements$';\r\nimport Movement from './utils/Movement';\r\nimport { QuadtreeNode } from './utils/Shapes';\r\nimport { IMovementState, IUnit, ShapeType, ShapePosition, ShapeState, CanvasContext, CanvasSize } from './types';\r\n\r\ninterface Initiate {\r\n  (canvasSize: CanvasSize, context: CanvasContext, cavas: Canvas): void\r\n}\r\ninterface Moving {\r\n  (movements: Array<IMovementState>, canvas: Canvas): void\r\n}\r\ntype BeforeMoving = Moving;\r\ninterface DidMoved {\r\n  (canvas: Canvas): void\r\n}\r\ninterface DidCatch {\r\n  (err: any, canvas: Canvas): void\r\n}\r\ninterface IMoveHooks {\r\n  beforeMoving?: BeforeMoving;\r\n  moving?: Moving;\r\n  didMoved?: DidMoved;\r\n  didCatch?: DidCatch;\r\n}\r\nclass Canvas {\r\n  // id\r\n  public id: string;\r\n  // 容器元素\r\n  public container: Element;\r\n  // canvas 上下文\r\n  public context!: CanvasContext;\r\n  // resize observer\r\n  private resizeObserver: ResizeObserver\r\n  private InitFunc: Initiate | undefined;\r\n  public isInitiated: boolean;\r\n  // canvas 宽高\r\n  public width!: number;\r\n  public height!: number;\r\n  // canvas内图形\r\n  private shapes!: Shapes;\r\n\r\n  constructor(\r\n    containerEl: Element,\r\n    InitFunc = undefined\r\n  ) {\r\n    this.id = `canvas-${v4()}`;\r\n    this.shapes = new Shapes(0, 0);\r\n    this.container = containerEl;\r\n    this.createCanvas(containerEl);\r\n    this.resizeObserver = new ResizeObserver(this.resizeObserverCallback.bind(this));\r\n    this.resizeObserver.observe(containerEl);\r\n    this.isInitiated = false;\r\n    this.InitFunc = InitFunc;\r\n  }\r\n  \r\n  public destroy () {\r\n    this.resizeObserver.disconnect();\r\n    this.shapes.clear();\r\n  }\r\n\r\n  public append (id: string, shape: ShapeType) {\r\n    this.shapes.append(id, shape);\r\n  }\r\n\r\n  public remove (id: string) {\r\n    this.shapes.remove(id);\r\n  }\r\n\r\n  change (id: string, state: ShapePosition): void;\r\n  change (id: string, state: (shape: ShapeType, canvasSize: CanvasSize) => ShapePosition): void;\r\n  public change (id: string, state: ShapePosition | ((shape: ShapeType, canvasSize: CanvasSize) => ShapePosition)) {\r\n    const shape = this.shapes.get(id);\r\n    const nextState = _isFunction(state) ?\r\n      state(shape, { width: this.width, height: this.height }) :\r\n      state;\r\n    this.shapes.change(id, shape, nextState);\r\n  }\r\n\r\n  public clear (x: number = 0, y: number = 0, w: number = this.width, h: number = this.height) {\r\n    const ctx = this.context;\r\n    ctx.clearRect(x, y, w, h);\r\n  }\r\n\r\n  public drawShapes () {\r\n    this.shapes.forEach((id: string, shape: ShapeType) => {\r\n      shape.draw(this);\r\n    })\r\n  }\r\n\r\n  public setSize (width: number, height: number) {\r\n    this.width = Math.floor(width);\r\n    this.height = Math.floor(height);\r\n    const canvas = this?.context?.canvas;\r\n    if (canvas) {\r\n      canvas.width = this.width;\r\n      canvas.height = this.height;\r\n    }\r\n    this.shapes.resize(width, height);\r\n  }\r\n\r\n  public test () {\r\n    this.shapes.show(\r\n      (qtNode: QuadtreeNode) => {\r\n        const bBox = new Rectangle({\r\n          x: qtNode.x,\r\n          y: qtNode.y,\r\n          width: qtNode.w,\r\n          height: qtNode.h,\r\n          fillStyle: '#333',\r\n          drawType: 'stroke'\r\n        });\r\n        bBox.draw(this);\r\n        if (qtNode.isLeaf) {\r\n          _each(\r\n            qtNode.units,\r\n            (shape: ShapeType) => {\r\n              shape.draw(this);\r\n            }\r\n          )\r\n        }\r\n      }\r\n    );\r\n  }\r\n\r\n  public init (InitFunc: Initiate) {\r\n    this.InitFunc = InitFunc;\r\n  }\r\n\r\n  private createCanvas (containerEl: Element) {\r\n    const canvasEl = document.createElement('canvas');\r\n    canvasEl.id = this.id;\r\n    this.context = canvasEl.getContext('2d') as CanvasContext;\r\n    containerEl.appendChild(canvasEl);\r\n  }\r\n\r\n  private resizeObserverCallback (entries: { contentRect: { width: number; height: number; }; }[]) {\r\n    entries.forEach((entry: { contentRect: { width: number; height: number; }; }) => {\r\n      const { width, height } = entry.contentRect;\r\n      this.isInitiated = false;\r\n      this.setSize(width, height);\r\n      this.clear();\r\n      this.isInitiated = true;\r\n      if (_isFunction(this.InitFunc)) this.InitFunc({ width, height }, this.context, this);\r\n      this.drawShapes();\r\n    });\r\n  }\r\n\r\n  move (\r\n    unit: IUnit,\r\n    hooks: IMoveHooks\r\n  ): void;\r\n  move (\r\n    units: Array<IUnit>,\r\n    hooks: IMoveHooks\r\n  ): void;\r\n  public move (\r\n    unit: IUnit | Array<IUnit>,\r\n    hooks: IMoveHooks\r\n  ): void {\r\n    const params = _isArray(unit) ? unit : [unit];\r\n    const size = { width: this.width, height: this.height }\r\n    const movement = new Movement();\r\n    getMovements$(params, size, movement)\r\n      .pipe(\r\n        tap((movements: Array<IMovementState>) => {\r\n          if (_isFunction(hooks.beforeMoving)) hooks.beforeMoving(movements, this);\r\n        })\r\n      )\r\n      .subscribe({\r\n        next: (movements: Array<IMovementState>) => {\r\n          _each(\r\n            movements,\r\n            ({ id, state }: IMovementState) => {\r\n              this.change(id, state);\r\n            }\r\n          );\r\n          if (_isFunction(hooks.moving)) hooks.moving(movements, this);\r\n        },\r\n        complete: () => {\r\n          movement.clear();\r\n          if (_isFunction(hooks.didMoved)) hooks.didMoved(this);\r\n        },\r\n        error: (err: any) => {\r\n          movement.clear();\r\n          if (_isFunction(hooks.didCatch)) hooks.didCatch(err, this);\r\n        }\r\n      });\r\n  }\r\n}\r\n\r\nexport default Canvas;\r\n","D:\\前端\\react基础架构\\bezier\\src\\Canvas\\Shape\\Circle.ts",[],"D:\\前端\\react基础架构\\bezier\\src\\Canvas\\Shape\\Rectangle.ts",[],"D:\\前端\\react基础架构\\bezier\\src\\utils\\cubicBezier2p.ts",[],"D:\\前端\\react基础架构\\bezier\\src\\Canvas\\utils\\Movement.ts",[],"D:\\前端\\react基础架构\\bezier\\src\\Canvas\\utils\\getMovements$.ts",[],"D:\\前端\\react基础架构\\bezier\\src\\Canvas\\utils\\getAbsolutePosition.ts",[],"D:\\前端\\react基础架构\\bezier\\src\\pages\\Quadtree\\index.tsx",["149","150"],"import React, { useRef, useEffect, useState, useCallback } from 'react';\r\nimport { Button } from 'antd';\r\nimport Canvas from '../../Canvas';\r\nimport Circle from '../../Canvas/Shape/Circle';\r\nimport Rectangle from '../../Canvas/Shape/Rectangle';\r\nimport utils from '../../utils';\r\nimport styles from './style.module.css';\r\n\r\nconst getCls = utils.getStyleCls(styles);\r\n\r\nconst RECTANGLE_COLOR = '#4169e1';\r\nconst CIRCLE_COLOR = '#d87093';\r\n\r\nconst getRectParams = (w: number, h: number) => {\r\n  const x = utils.random(0, w);\r\n  const y = utils.random(0, h);\r\n  const width = utils.random(\r\n    Math.round(w/50),\r\n    Math.round(w/100)\r\n  );\r\n  const height = utils.random(\r\n    Math.round(h/50),\r\n    Math.round(h/100)\r\n  );\r\n  return { x, y, width, height, fillStyle: RECTANGLE_COLOR };\r\n}\r\n\r\nconst getCircleParams = (w: number, h: number) => {\r\n  const x = utils.random(0, w);\r\n  const y = utils.random(0, h);\r\n  const radius = utils.random(\r\n    Math.round(w/50),\r\n    Math.round(w/100)\r\n  );\r\n  return { x, y, radius, fillStyle: CIRCLE_COLOR };\r\n}\r\n\r\nconst Quadtree = () => {\r\n  const containerRef = useRef<HTMLDivElement>(null);\r\n  const canvasRef = useRef<Canvas>();\r\n\r\n  const addRect = () => {\r\n    const canvas = canvasRef.current;\r\n    if (!canvas) return;\r\n    const rectParams = getRectParams(canvas.width, canvas.height);\r\n    const rect = new Rectangle(rectParams);\r\n    canvas.append(rect.id, rect);\r\n    canvas.test();\r\n  };\r\n\r\n  const addCircle = () => {\r\n    const canvas = canvasRef.current;\r\n    if (!canvas) return;\r\n    const circleParams = getCircleParams(canvas.width, canvas.height);\r\n    const circle = new Circle(circleParams);\r\n    canvas.append(circle.id, circle);\r\n    canvas.test();\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (containerRef.current) {\r\n      canvasRef.current = new Canvas(containerRef.current);\r\n    }\r\n    return () => {\r\n      canvasRef?.current?.destroy();\r\n    }\r\n  // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, []);\r\n\r\n  return (\r\n    <div className={getCls('container')}>\r\n      <div className={getCls('stage')} ref={containerRef}/>\r\n      <div className={getCls('controller')}>\r\n        <Button onClick={addRect} type=\"primary\">\r\n          添加矩形\r\n        </Button>\r\n        <Button onClick={addCircle} type=\"primary\" style={{ marginLeft: 12 }} >\r\n          添加圆型\r\n        </Button>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Quadtree;\r\n","D:\\前端\\react基础架构\\bezier\\src\\utils\\random.ts",[],"D:\\前端\\react基础架构\\bezier\\src\\Canvas\\utils\\Shapes.ts",["151"],{"ruleId":"152","replacedBy":"153"},{"ruleId":"154","replacedBy":"155"},{"ruleId":"156","severity":1,"message":"157","line":31,"column":11,"nodeType":"158","messageId":"159","endLine":31,"endColumn":24},{"ruleId":"152","replacedBy":"160"},{"ruleId":"154","replacedBy":"161"},{"ruleId":"156","severity":1,"message":"162","line":3,"column":15,"nodeType":"158","messageId":"159","endLine":3,"endColumn":18},{"ruleId":"156","severity":1,"message":"163","line":3,"column":28,"nodeType":"158","messageId":"159","endLine":3,"endColumn":42},{"ruleId":"156","severity":1,"message":"164","line":1,"column":28,"nodeType":"158","messageId":"159","endLine":1,"endColumn":35},{"ruleId":"156","severity":1,"message":"165","line":1,"column":45,"nodeType":"158","messageId":"159","endLine":1,"endColumn":53},{"ruleId":"156","severity":1,"message":"166","line":13,"column":10,"nodeType":"158","messageId":"159","endLine":13,"endColumn":32},{"ruleId":"156","severity":1,"message":"167","line":14,"column":10,"nodeType":"158","messageId":"159","endLine":14,"endColumn":16},{"ruleId":"156","severity":1,"message":"168","line":12,"column":59,"nodeType":"158","messageId":"159","endLine":12,"endColumn":69},{"ruleId":"156","severity":1,"message":"165","line":1,"column":36,"nodeType":"158","messageId":"159","endLine":1,"endColumn":44},{"ruleId":"156","severity":1,"message":"169","line":1,"column":46,"nodeType":"158","messageId":"159","endLine":1,"endColumn":57},{"ruleId":"156","severity":1,"message":"170","line":1,"column":8,"nodeType":"158","messageId":"159","endLine":1,"endColumn":16},"no-native-reassign",["171"],"no-negated-in-lhs",["172"],"@typescript-eslint/no-unused-vars","'initialPlayer' is assigned a value but never used.","Identifier","unusedVar",["171"],["172"],"'map' is defined but never used.","'withLatestFrom' is defined but never used.","'useMemo' is defined but never used.","'useState' is defined but never used.","'IDrawBallMotionOptions' is defined but never used.","'IPoint' is defined but never used.","'ShapeState' is defined but never used.","'useCallback' is defined but never used.","'_toPairs' is defined but never used.","no-global-assign","no-unsafe-negation"]