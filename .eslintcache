[{"D:\\前端\\react基础架构\\bezier\\src\\index.tsx":"1","D:\\前端\\react基础架构\\bezier\\src\\reportWebVitals.ts":"2","D:\\前端\\react基础架构\\bezier\\src\\App.tsx":"3","D:\\前端\\react基础架构\\bezier\\src\\components\\ControlPoints\\index.tsx":"4","D:\\前端\\react基础架构\\bezier\\src\\models\\controlPoints.ts":"5","D:\\前端\\react基础架构\\bezier\\src\\components\\Stage\\index.tsx":"6","D:\\前端\\react基础架构\\bezier\\src\\utils\\index.ts":"7","D:\\前端\\react基础架构\\bezier\\src\\utils\\toFixed.ts":"8","D:\\前端\\react基础架构\\bezier\\src\\components\\ControlPoints\\InputRange.tsx":"9","D:\\前端\\react基础架构\\bezier\\src\\components\\Stage\\contants.ts":"10","D:\\前端\\react基础架构\\bezier\\src\\components\\Stage\\draws.ts":"11","D:\\前端\\react基础架构\\bezier\\src\\utils\\calculateBezier.ts":"12","D:\\前端\\react基础架构\\bezier\\src\\utils\\getStyleCls.ts":"13","D:\\前端\\react基础架构\\bezier\\src\\models\\controlPlayer.ts":"14","D:\\前端\\react基础架构\\bezier\\src\\utils\\p2CubicBezier.ts":"15","D:\\前端\\react基础架构\\bezier\\src\\components\\Compare\\index.tsx":"16","D:\\前端\\react基础架构\\bezier\\src\\hooks\\useResize.ts":"17","D:\\前端\\react基础架构\\bezier\\src\\hooks\\useMulticast.ts":"18","D:\\前端\\react基础架构\\bezier\\src\\utils\\getMotion$.ts":"19","D:\\前端\\react基础架构\\bezier\\src\\utils\\getCtxByStage.ts":"20","D:\\前端\\react基础架构\\bezier\\src\\utils\\drawPoint.ts":"21","D:\\前端\\react基础架构\\bezier\\src\\components\\Display\\index.tsx":"22","D:\\前端\\react基础架构\\bezier\\src\\Canvas\\index.ts":"23","D:\\前端\\react基础架构\\bezier\\src\\Canvas\\Shape\\Circle.ts":"24","D:\\前端\\react基础架构\\bezier\\src\\Canvas\\Shape\\Rectangle.ts":"25","D:\\前端\\react基础架构\\bezier\\src\\utils\\cubicBezier2p.ts":"26","D:\\前端\\react基础架构\\bezier\\src\\Canvas\\utils\\Movement.ts":"27","D:\\前端\\react基础架构\\bezier\\src\\Canvas\\utils\\getMovements$.ts":"28","D:\\前端\\react基础架构\\bezier\\src\\Canvas\\utils\\getAbsolutePosition.ts":"29"},{"size":500,"mtime":1607750933546,"results":"30","hashOfConfig":"31"},{"size":425,"mtime":1607745288397,"results":"32","hashOfConfig":"31"},{"size":790,"mtime":1608820477824,"results":"33","hashOfConfig":"31"},{"size":6000,"mtime":1610213019139,"results":"34","hashOfConfig":"31"},{"size":635,"mtime":1610203710086,"results":"35","hashOfConfig":"31"},{"size":2809,"mtime":1609257336242,"results":"36","hashOfConfig":"31"},{"size":787,"mtime":1610183452295,"results":"37","hashOfConfig":"31"},{"size":359,"mtime":1607757739271,"results":"38","hashOfConfig":"31"},{"size":1009,"mtime":1608044940771,"results":"39","hashOfConfig":"31"},{"size":430,"mtime":1608649541837,"results":"40","hashOfConfig":"31"},{"size":4153,"mtime":1608649993050,"results":"41","hashOfConfig":"31"},{"size":761,"mtime":1610192228946,"results":"42","hashOfConfig":"31"},{"size":476,"mtime":1608047674449,"results":"43","hashOfConfig":"31"},{"size":429,"mtime":1608649868864,"results":"44","hashOfConfig":"31"},{"size":491,"mtime":1610204135818,"results":"45","hashOfConfig":"31"},{"size":1247,"mtime":1608649959108,"results":"46","hashOfConfig":"31"},{"size":1031,"mtime":1608990596266,"results":"47","hashOfConfig":"31"},{"size":1469,"mtime":1608652027482,"results":"48","hashOfConfig":"31"},{"size":2952,"mtime":1610189413933,"results":"49","hashOfConfig":"31"},{"size":202,"mtime":1608479298543,"results":"50","hashOfConfig":"31"},{"size":390,"mtime":1608479563649,"results":"51","hashOfConfig":"31"},{"size":3075,"mtime":1610215173010,"results":"52","hashOfConfig":"31"},{"size":5164,"mtime":1610207497717,"results":"53","hashOfConfig":"31"},{"size":1580,"mtime":1610182699423,"results":"54","hashOfConfig":"31"},{"size":1640,"mtime":1610182496863,"results":"55","hashOfConfig":"31"},{"size":1353,"mtime":1610215094310,"results":"56","hashOfConfig":"31"},{"size":922,"mtime":1610210859947,"results":"57","hashOfConfig":"31"},{"size":4838,"mtime":1610213389624,"results":"58","hashOfConfig":"31"},{"size":735,"mtime":1610195050301,"results":"59","hashOfConfig":"31"},{"filePath":"60","messages":"61","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"62"},"j32ste",{"filePath":"63","messages":"64","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"62"},{"filePath":"65","messages":"66","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"62"},{"filePath":"67","messages":"68","errorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"69","usedDeprecatedRules":"62"},{"filePath":"70","messages":"71","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"62"},{"filePath":"72","messages":"73","errorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"74","usedDeprecatedRules":"62"},{"filePath":"75","messages":"76","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"62"},{"filePath":"77","messages":"78","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"62"},{"filePath":"79","messages":"80","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"62"},{"filePath":"81","messages":"82","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"62"},{"filePath":"83","messages":"84","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"62"},{"filePath":"85","messages":"86","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"62"},{"filePath":"87","messages":"88","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"62"},{"filePath":"89","messages":"90","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"62"},{"filePath":"91","messages":"92","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"62"},{"filePath":"93","messages":"94","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"62"},{"filePath":"95","messages":"96","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"62"},{"filePath":"97","messages":"98","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"62"},{"filePath":"99","messages":"100","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"62"},{"filePath":"101","messages":"102","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"62"},{"filePath":"103","messages":"104","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"62"},{"filePath":"105","messages":"106","errorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"107","usedDeprecatedRules":"62"},{"filePath":"108","messages":"109","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"62"},{"filePath":"110","messages":"111","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"62"},{"filePath":"112","messages":"113","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"62"},{"filePath":"114","messages":"115","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"62"},{"filePath":"116","messages":"117","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"62"},{"filePath":"118","messages":"119","errorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"120"},{"filePath":"121","messages":"122","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"62"},"D:\\前端\\react基础架构\\bezier\\src\\index.tsx",[],["123","124"],"D:\\前端\\react基础架构\\bezier\\src\\reportWebVitals.ts",[],"D:\\前端\\react基础架构\\bezier\\src\\App.tsx",[],"D:\\前端\\react基础架构\\bezier\\src\\components\\ControlPoints\\index.tsx",["125"],"import React, { useMemo } from 'react';\r\nimport { Form, Button, Select, Row, Col } from 'antd';\r\nimport { CopyrightTwoTone } from '@ant-design/icons';\r\nimport InputRange from './InputRange';\r\nimport _omit from 'lodash/omit';\r\nimport _split from 'lodash/split';\r\nimport _map from 'lodash/map';\r\nimport _has from 'lodash/has';\r\nimport utils from '../../utils'\r\nimport { IControlPoints } from '../../models/controlPoints';\r\nimport useControlPoints from '../../models/controlPoints'\r\nimport useControlPlayer from '../../models/controlPlayer'\r\n\r\nconst libaray = [\r\n  { label: 'ease', value: '.25,.1,.25,1' },\r\n  { label: 'linear', value: '0,0,1,1' },\r\n  { label: 'ease-in', value: '.42,0,1,1' },\r\n  { label: 'ease-out', value: '0,0,.58,1' },\r\n  { label: 'ease-in-out', value: '.42,0,.58,1' }\r\n]\r\n\r\ninterface IForm extends Omit<IControlPoints, 'cubicBezier'> {\r\n  libaray: string | undefined;\r\n  duration: number;\r\n}\r\n\r\nfunction ControlPoints(props: Partial<{ className: string }>) {\r\n  const { className } = props;\r\n\r\n  const { initialPoints, points, setPoints } = useControlPoints();\r\n  const { initialPlayer, player, setPlayer } = useControlPlayer();\r\n  const [form] = Form.useForm<IForm>();\r\n  const initialFormValues = useMemo(() => {\r\n    return {\r\n      libaray: undefined,\r\n      ...initialPoints,\r\n    }\r\n  }, [initialPoints])\r\n\r\n  const onFinish = (values: IForm, run = true) => {\r\n    if (!player.run) {\r\n      const nextPoints = _omit(values, ['libaray']);\r\n      const { cp1x, cp1y, cp2x, cp2y } = nextPoints;\r\n      const cubicBezier = utils.p2CubicBezier({ cp1x, cp1y, cp2x, cp2y });\r\n      setPoints({ ...nextPoints, cubicBezier });\r\n      setPlayer({ run });\r\n    }\r\n  }\r\n\r\n  const onReset = () => {\r\n    const formValues = {\r\n      ...initialPoints,\r\n      libaray: undefined\r\n    };\r\n    form.setFieldsValue(formValues);\r\n    onFinish(formValues, false);\r\n  }\r\n\r\n  const onFormChange = (changedValues: Partial<IForm>, allValues: IForm) => {\r\n    if (_has(changedValues, 'libaray')) {\r\n      if (changedValues.libaray === undefined) {\r\n        onReset();\r\n      } else {\r\n        const cps = _split(changedValues.libaray, ',');\r\n        const [cp1x, cp1y, cp2x, cp2y] = _map(cps, Number);\r\n        const formValues = {\r\n          duration: allValues.duration,\r\n          libaray: changedValues.libaray,\r\n          cp1x,\r\n          cp1y,\r\n          cp2x,\r\n          cp2y\r\n        };\r\n        form.setFieldsValue(formValues);\r\n        onFinish(formValues, false);\r\n      }\r\n    } else {\r\n      const formValues = {\r\n        ...allValues,\r\n        libaray: undefined\r\n      };\r\n      form.setFieldsValue(formValues);\r\n      onFinish(formValues, false);\r\n    }\r\n  }\r\n\r\n  return (\r\n    <Form\r\n      className={className}\r\n      form={form} \r\n      initialValues={initialFormValues} \r\n      name=\"control-points\" \r\n      onFinish={onFinish} \r\n      onValuesChange={onFormChange}\r\n      labelCol={{ span: 8 }}\r\n      wrapperCol={{ span: 16 }}\r\n    >\r\n      <Row justify=\"start\" >\r\n        <Col span={10}>\r\n          <Form.Item\r\n            name=\"cp1x\"\r\n            label={\r\n              <span>\r\n                控制点X1\r\n                <CopyrightTwoTone twoToneColor=\"#52c41a\" style={{marginLeft: 6}} />\r\n              </span>\r\n            }\r\n            rules={[{ required: true }]}\r\n          >\r\n            <InputRange min={0} max={1} step={0.01} />\r\n          </Form.Item>\r\n        </Col>\r\n        <Col span={10}>\r\n          <Form.Item\r\n            name=\"cp1y\"\r\n            label={\r\n              <span>\r\n                控制点Y1\r\n                <CopyrightTwoTone twoToneColor=\"#52c41a\" style={{marginLeft: 6}} />\r\n              </span>\r\n            }\r\n            rules={[{ required: true }]}\r\n          >\r\n            <InputRange min={-1} max={2} step={0.01} />\r\n          </Form.Item>\r\n        </Col>\r\n      </Row>\r\n      <Row justify=\"start\" >\r\n        <Col span={10}>\r\n          <Form.Item\r\n            name=\"cp2x\"\r\n            label={\r\n              <span>\r\n                控制点X2\r\n                <CopyrightTwoTone twoToneColor=\"#ff5722\" style={{marginLeft: 6}} />\r\n              </span>\r\n            }\r\n            rules={[{ required: true }]}\r\n          >\r\n            <InputRange min={0} max={1} step={0.01} />\r\n          </Form.Item>\r\n        </Col>\r\n        <Col span={10}>\r\n          <Form.Item\r\n            name=\"cp2y\"\r\n            label={\r\n              <span>\r\n                控制定Y2\r\n                <CopyrightTwoTone twoToneColor=\"#ff5722\" style={{marginLeft: 6}} />\r\n              </span>\r\n            }\r\n            rules={[{ required: true }]}\r\n          >\r\n            <InputRange min={-1} max={2} step={0.01} />\r\n          </Form.Item>\r\n        </Col>\r\n      </Row>\r\n      <Row justify=\"start\" >\r\n        <Col span={10}>\r\n          <Form.Item\r\n            name=\"libaray\"\r\n            label=\"缓动函数\"\r\n          >\r\n            <Select\r\n              size=\"small\"\r\n              style={{ width: 200 }}\r\n              options={libaray}\r\n              optionLabelProp=\"label\"\r\n              allowClear\r\n            />\r\n          </Form.Item>\r\n        </Col>\r\n        <Col span={10}>\r\n          <Form.Item\r\n            name=\"duration\"\r\n            label=\"时间\"\r\n            rules={[{ required: true }]}\r\n          >\r\n            <InputRange min={initialPoints.duration} max={10000} step={500} />\r\n          </Form.Item>\r\n        </Col>\r\n      </Row>\r\n      <Row justify=\"start\" >        \r\n        <Col span={10}>\r\n          <Form.Item label=\"贝塞尔曲线\">\r\n            <span>{points.cubicBezier}</span>\r\n          </Form.Item>\r\n        </Col>\r\n        <Col span={10} offset={4} >\r\n          <Form.Item>\r\n            <Button type=\"primary\" htmlType=\"submit\">\r\n              开始\r\n            </Button>\r\n            <Button style={{ marginLeft: 12 }} htmlType=\"button\" onClick={onReset}>\r\n              重置\r\n            </Button>\r\n          </Form.Item>\r\n        </Col>\r\n      </Row>\r\n    </Form>\r\n  );\r\n}\r\n\r\nexport default ControlPoints;\r\n","D:\\前端\\react基础架构\\bezier\\src\\models\\controlPoints.ts",[],"D:\\前端\\react基础架构\\bezier\\src\\components\\Stage\\index.tsx",["126","127"],"import React, { useMemo, useRef } from 'react';\r\nimport { of, concat } from 'rxjs';\r\nimport { tap, map, filter, withLatestFrom } from 'rxjs/operators';\r\nimport useResize from '../../hooks/useResize';\r\nimport useControlPoints from '../../models/controlPoints';\r\nimport useControlPlayer from '../../models/controlPlayer';\r\nimport useMulticast from '../../hooks/useMulticast';\r\nimport { drawCoordinates, drawBezierCurvePoint, getPoints$ } from './draws';\r\nimport { PADDING } from './contants';\r\nimport { IStageOptions, IDrawCoordinatesOptions, IDrawBezierCurveOptions } from './types';\r\n\r\nfunction Stage (props: Partial<{ className: string }>) {\r\n  const { className } = props;\r\n\r\n  const containerRef = useRef<HTMLDivElement>(null);\r\n  const canvasRef = useRef<HTMLCanvasElement>(null);\r\n\r\n  const { width, height } = useResize(containerRef.current);\r\n\r\n  const { points: controlPonitsOptions } = useControlPoints();\r\n  const { player: controlPlayer, setPlayer: setControlPonitsPlayer } = useControlPlayer();\r\n\r\n  const stageOptions: IStageOptions = useMemo(() => {\r\n    const _width = Math.floor(width);\r\n    const _height = Math.floor(height);\r\n    const axisXLength = Math.floor(_width - (2 * PADDING));\r\n    const axisYLength = Math.floor((1 / 3)  * (_height - (2 * PADDING)));\r\n    const originX = PADDING;\r\n    const originY = 2 * axisYLength + PADDING;\r\n\r\n    return {\r\n      x0: originX,\r\n      y0: originY,\r\n      xLen: axisXLength,\r\n      yLen: axisYLength,\r\n      stageW: _width,\r\n      stageH: _height,\r\n      stage: canvasRef\r\n    };\r\n  }, [width, height]);\r\n\r\n  const drawBezierCurve = ([stageOptions, controlPonits, controlPlayer]: IDrawBezierCurveOptions) => {\r\n    console.log('ddd', controlPlayer);\r\n    const clear$ = of<IDrawCoordinatesOptions>([stageOptions, controlPonits]).pipe(\r\n      tap(drawCoordinates)\r\n    );\r\n    const drawPoints$ = getPoints$(stageOptions, controlPonits, controlPlayer).pipe(\r\n      tap(drawBezierCurvePoint)\r\n    );\r\n    const draw$ = concat(clear$, drawPoints$);\r\n    draw$.subscribe({\r\n      complete: () => {\r\n        setControlPonitsPlayer({ ...controlPlayer, run: false });\r\n      },\r\n      error: () => {\r\n        setControlPonitsPlayer({ ...controlPlayer, run: false });\r\n      }\r\n    });\r\n  }\r\n\r\n  useMulticast<IDrawCoordinatesOptions>(\r\n    [drawCoordinates],\r\n    [stageOptions, controlPonitsOptions]\r\n  );\r\n\r\n  useMulticast<IDrawBezierCurveOptions>(\r\n    [drawBezierCurve],\r\n    [stageOptions, controlPonitsOptions, controlPlayer],\r\n    (dependency$) => {\r\n      return dependency$.pipe(\r\n        filter((dep) => dep[2].run)\r\n      );\r\n    }\r\n  );\r\n\r\n  return (\r\n    <div className={className} ref={containerRef}>\r\n      <canvas ref={canvasRef} width={stageOptions.stageW} height={stageOptions.stageH} />\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default Stage;\r\n","D:\\前端\\react基础架构\\bezier\\src\\utils\\index.ts",[],"D:\\前端\\react基础架构\\bezier\\src\\utils\\toFixed.ts",[],"D:\\前端\\react基础架构\\bezier\\src\\components\\ControlPoints\\InputRange.tsx",[],"D:\\前端\\react基础架构\\bezier\\src\\components\\Stage\\contants.ts",[],"D:\\前端\\react基础架构\\bezier\\src\\components\\Stage\\draws.ts",[],"D:\\前端\\react基础架构\\bezier\\src\\utils\\calculateBezier.ts",[],"D:\\前端\\react基础架构\\bezier\\src\\utils\\getStyleCls.ts",[],"D:\\前端\\react基础架构\\bezier\\src\\models\\controlPlayer.ts",[],"D:\\前端\\react基础架构\\bezier\\src\\utils\\p2CubicBezier.ts",[],"D:\\前端\\react基础架构\\bezier\\src\\components\\Compare\\index.tsx",[],"D:\\前端\\react基础架构\\bezier\\src\\hooks\\useResize.ts",[],"D:\\前端\\react基础架构\\bezier\\src\\hooks\\useMulticast.ts",[],"D:\\前端\\react基础架构\\bezier\\src\\utils\\getMotion$.ts",[],"D:\\前端\\react基础架构\\bezier\\src\\utils\\getCtxByStage.ts",[],"D:\\前端\\react基础架构\\bezier\\src\\utils\\drawPoint.ts",[],"D:\\前端\\react基础架构\\bezier\\src\\components\\Display\\index.tsx",["128","129","130","131"],"import React, { useEffect, useMemo, useRef, useState } from 'react';\r\nimport useConstant from 'use-constant';\r\nimport { tap, filter } from 'rxjs/operators';\r\nimport { useObservable } from \"rxjs-hooks\";\r\nimport utils from '../../utils';\r\nimport getAbsolutePosition from '../../Canvas/utils/getAbsolutePosition';\r\nimport Canvas from '../../Canvas';\r\nimport Circle from '../../Canvas/Shape/Circle';\r\nimport Rectangle from '../../Canvas/Shape/Rectangle';\r\nimport useControlPoints from '../../models/controlPoints';\r\nimport useControlPlayer from '../../models/controlPlayer';\r\nimport { DUE_TIME } from '../Stage/contants';\r\nimport { IDrawBallMotionOptions } from './types';\r\nimport { IPoint } from '../../types';\r\nimport styles from './display.module.css';\r\n\r\nconst getCls = utils.getStyleCls(styles);\r\n\r\nconst BALL_RADIUS = 12.5;\r\nconst BALL_BOTTOM = 756;\r\nconst BALL_TOP = 181;\r\nconst BALL_COLOR = '#d87093';\r\nconst RECT_HEIGHT = 600;\r\nconst RECT_COLOR = '#ffffff';\r\nconst RECT = {\r\n  x: 0,\r\n  y: 168.5,\r\n  width: '100%',\r\n  height: RECT_HEIGHT,\r\n  fillStyle: RECT_COLOR \r\n};\r\nconst BALL = {\r\n  x: 84,\r\n  y: 756,\r\n  radius: BALL_RADIUS,\r\n  fillStyle: BALL_COLOR\r\n};\r\n\r\nfunction Display() {\r\n  const containerRef = useRef<HTMLDivElement>(null);\r\n  const canvasRef = useRef<Canvas>();\r\n  const rect = useConstant(() => new Rectangle({\r\n    ...RECT,\r\n    width: 0\r\n  }));\r\n  const ball = useConstant(() => new Circle(BALL));\r\n\r\n  useEffect(() => {\r\n    if (containerRef.current) {\r\n      canvasRef.current = new Canvas(containerRef.current);\r\n      canvasRef?.current?.init(\r\n        (canvasSize, context, canvas) => {\r\n          canvas.append(rect.id, rect);\r\n          canvas.append(ball.id, ball);\r\n          const rectWidth = getAbsolutePosition(RECT.width, 'width', canvasSize);\r\n          canvas.change(rect.id, { width: rectWidth });\r\n          canvas.drawShapes();\r\n        }\r\n      );\r\n    }\r\n    return () => {\r\n      canvasRef?.current?.destroy();\r\n    }\r\n  // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, []);\r\n\r\n  const { points: controlPonits } = useControlPoints();\r\n  const { player: controlPlayer } = useControlPlayer();\r\n\r\n  useObservable((_, inputs$) => inputs$.pipe(\r\n    filter((inputs) => {\r\n      const isInitiated = canvasRef?.current?.isInitiated ?? false;\r\n      const run = inputs[1].run;\r\n      return isInitiated && run;\r\n    }),\r\n    tap(([controlPonitsOptions]) => {\r\n      const endY = ball.y === BALL_BOTTOM ? BALL_TOP : BALL_BOTTOM;\r\n      const unit = {\r\n        shape: ball,\r\n        state: { y: endY },\r\n        cubicBezier: controlPonitsOptions.cubicBezier,\r\n        delay: DUE_TIME,\r\n        duration: controlPonitsOptions.duration\r\n      };\r\n      canvasRef?.current?.move(\r\n        unit,\r\n        {\r\n          moving: (_, canvas) => {\r\n            canvas.clear();\r\n            canvas.drawShapes();\r\n          }\r\n        }\r\n      );\r\n    }),\r\n  ), [controlPonits, controlPlayer], [controlPonits, controlPlayer])\r\n\r\n  return (\r\n    <div className={getCls('container')} ref={containerRef} />\r\n  );\r\n}\r\n\r\nexport default Display;\r\n","D:\\前端\\react基础架构\\bezier\\src\\Canvas\\index.ts",[],"D:\\前端\\react基础架构\\bezier\\src\\Canvas\\Shape\\Circle.ts",[],"D:\\前端\\react基础架构\\bezier\\src\\Canvas\\Shape\\Rectangle.ts",[],"D:\\前端\\react基础架构\\bezier\\src\\utils\\cubicBezier2p.ts",[],"D:\\前端\\react基础架构\\bezier\\src\\Canvas\\utils\\Movement.ts",[],"D:\\前端\\react基础架构\\bezier\\src\\Canvas\\utils\\getMovements$.ts",["132"],"import { timer, animationFrameScheduler, Observable } from 'rxjs';\r\nimport { map, scan, takeWhile } from 'rxjs/operators';\r\nimport _isFunction from 'lodash/isFunction';\r\nimport _map from 'lodash/map';\r\nimport _get from 'lodash/get';\r\nimport _every from 'lodash/every';\r\nimport _some from 'lodash/some';\r\nimport _toPairs from 'lodash/toPairs';\r\nimport utils from '../../utils';\r\nimport Movement from './Movement';\r\nimport { IPoint } from '../../types';\r\nimport { IMovement, IMovementState, IUnit, ShapePosition, CanvasSize, ShapeState } from '../types';\r\n\r\ntype OrientationType = 0 | 1 | -1; \r\ninterface ICalculateBezierParam {\r\n  distance: number;\r\n  orientation: OrientationType;\r\n  endP: IPoint;\r\n  cp1P: IPoint;\r\n  cp2P: IPoint;\r\n};\r\n\r\ninterface ICalculateBezierUnit {\r\n  id: string;\r\n  delay: number;\r\n  duration: number;\r\n  params: Array<ICalculateBezierParam>;\r\n  movements: Array<IMovement>;\r\n  isMoving: boolean;\r\n  isMoved: boolean;\r\n}\r\nconst getCalculateBezierUnitsParams = (units: Array<IUnit>, canvasSize: CanvasSize): Array<ICalculateBezierUnit> => {\r\n  return _map(\r\n    units,\r\n    (unit: IUnit): ICalculateBezierUnit => {\r\n      const { shape, state, duration } = unit;\r\n      const cubicBezier = _get(unit, 'cubicBezier', 'linear');\r\n      const [cp1, cp2] = utils.cubicBezier2p(cubicBezier);\r\n      const delay = _get(unit, 'delay', 0);\r\n      const endState = _isFunction(state) ?\r\n        _toPairs(state(shape, canvasSize)) :\r\n        _toPairs(state) ;\r\n      const movements: Array<IMovement> = [];\r\n      const params = _map<any[], ICalculateBezierParam>(\r\n        endState,\r\n        ([key, end]: [keyof ShapePosition, number]): ICalculateBezierParam => {\r\n          const start = shape[key];\r\n          const distance = Math.abs(end - start);\r\n          const orientation = distance === 0 ?\r\n            0 :\r\n            end > start ?\r\n              1 :\r\n              -1;\r\n          const endP: IPoint = [duration, distance];\r\n          const cp1P: IPoint = [duration * cp1[0], distance * cp1[1]];\r\n          const cp2P: IPoint = [duration * cp2[0], distance * cp2[1]];\r\n          movements.push({ startTime: undefined, curr: undefined, prev: undefined, percent: 0, key, start });\r\n          return { distance, orientation, endP, cp1P, cp2P};\r\n        }\r\n      );\r\n      return { id: shape.id, params, delay, duration, movements, isMoving: false, isMoved: false };\r\n    }\r\n  );\r\n};\r\nconst PERIOD = 16;\r\n\r\ninterface IScanAcc {\r\n  startTimeLine: undefined | number;\r\n  unitsParams: Array<ICalculateBezierUnit>;\r\n} \r\n\r\nexport default function getMovements$ (\r\n  units: Array<IUnit>,\r\n  canvasSize: CanvasSize,\r\n  unitsState: Movement\r\n): Observable<Array<IMovementState>> {\r\n  const unitsParams = getCalculateBezierUnitsParams(units, canvasSize);\r\n  return timer(0, PERIOD, animationFrameScheduler)\r\n    .pipe(\r\n      scan(\r\n        (acc: IScanAcc): IScanAcc => {\r\n          const currTimeLine = Date.now();\r\n          const startTimeLine = _get(acc, 'startTimeLine', currTimeLine);\r\n          const diffTimeLine = currTimeLine - startTimeLine;\r\n          const accUnitsParams = _map(\r\n            acc.unitsParams,\r\n            (unit: ICalculateBezierUnit) => {\r\n              if (!unit.isMoving && diffTimeLine < unit.delay) return unit;\r\n              const unitMovements = _map(\r\n                unit.movements,\r\n                (movement: IMovement, index: number) => {\r\n                  if (movement.percent >= 1) return movement;\r\n                  const { distance, endP, cp1P, cp2P, orientation } = unit.params[index]\r\n                  const startTime = _get(movement, 'startTime', currTimeLine);\r\n                  const diff = currTimeLine - startTime;\r\n                  let percent = diff / unit.duration;\r\n                  percent = percent > 1 ? 1 : percent;\r\n                  let curr = movement.start;\r\n                  if (distance !== 0) {\r\n                    const { deltaD } = utils.calculateBezier(percent, endP, cp1P, cp2P);\r\n                    curr = curr + (deltaD * orientation);\r\n                    curr = utils.toFixed(curr, 2);\r\n                  }\r\n                  const prev = _get(movement, 'prev', movement.start);\r\n                  unitsState.setState(unit.id, movement.key, curr);\r\n                  return { ...movement, startTime, curr, prev, percent };\r\n                }\r\n              );\r\n              const unitIsMoved = _every(unitMovements, ['percent', 1]);\r\n              return { ...unit, movements: unitMovements, isMoved: unitIsMoved, isMoving: true };\r\n            }\r\n          );\r\n          return { startTimeLine, unitsParams: accUnitsParams };\r\n        },\r\n        { startTimeLine: undefined, unitsParams }\r\n      ),\r\n      takeWhile(({ unitsParams }) => _some(unitsParams, ['isMoved', false]), true),\r\n      map((_) => unitsState.getState())\r\n    )\r\n};\r\n","D:\\前端\\react基础架构\\bezier\\src\\Canvas\\utils\\getAbsolutePosition.ts",[],{"ruleId":"133","replacedBy":"134"},{"ruleId":"135","replacedBy":"136"},{"ruleId":"137","severity":1,"message":"138","line":31,"column":11,"nodeType":"139","messageId":"140","endLine":31,"endColumn":24},{"ruleId":"137","severity":1,"message":"141","line":3,"column":15,"nodeType":"139","messageId":"140","endLine":3,"endColumn":18},{"ruleId":"137","severity":1,"message":"142","line":3,"column":28,"nodeType":"139","messageId":"140","endLine":3,"endColumn":42},{"ruleId":"137","severity":1,"message":"143","line":1,"column":28,"nodeType":"139","messageId":"140","endLine":1,"endColumn":35},{"ruleId":"137","severity":1,"message":"144","line":1,"column":45,"nodeType":"139","messageId":"140","endLine":1,"endColumn":53},{"ruleId":"137","severity":1,"message":"145","line":13,"column":10,"nodeType":"139","messageId":"140","endLine":13,"endColumn":32},{"ruleId":"137","severity":1,"message":"146","line":14,"column":10,"nodeType":"139","messageId":"140","endLine":14,"endColumn":16},{"ruleId":"137","severity":1,"message":"147","line":12,"column":71,"nodeType":"139","messageId":"140","endLine":12,"endColumn":81},"no-native-reassign",["148"],"no-negated-in-lhs",["149"],"@typescript-eslint/no-unused-vars","'initialPlayer' is assigned a value but never used.","Identifier","unusedVar","'map' is defined but never used.","'withLatestFrom' is defined but never used.","'useMemo' is defined but never used.","'useState' is defined but never used.","'IDrawBallMotionOptions' is defined but never used.","'IPoint' is defined but never used.","'ShapeState' is defined but never used.","no-global-assign","no-unsafe-negation"]